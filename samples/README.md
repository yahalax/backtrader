# Backtrader Samples 示例程序整理

以下是 `samples` 目录下各示例程序的分类整理，涵盖数据加载、策略开发、优化、回测和结果分析等多个方面。

---

## **数据加载与处理**

| 示例程序名称 | 详细功能描述 | 参数/使用方法 |
|--------------|----------|---------------|
| **data-bid-ask** | 演示如何加载和处理包含买价（Bid）和卖价（Ask）的行情数据，适用于高频或盘口数据分析。 | 无参数，直接运行 |
| **data-filler** | 展示如何对缺失的行情数据进行自动填充，支持自定义数据文件、起止日期、交易时段、是否添加相对成交量指标等。 | `--data` 数据文件路径，`--tstart` 交易起始时间，`--tend` 交易结束时间，`--relvol` 添加相对成交量，`--fromdate` 起始日期，`--todate` 结束日期，`--writer` 添加writer，`--wrcsv` 输出csv，`--plot` 绘图，`--numfigs` 绘图窗口数 |
| **data-multitimeframe** | 演示如何在同一策略中加载和处理多种时间周期的数据，支持主副数据文件、重采样/回放、同步方式、周期参数等多种灵活配置。 | `--dataname` 主数据文件，`--dataname2` 副数据文件，`--runnext` next模式，`--nopreload` 不预加载，`--oldsync` 旧同步，`--oldrs` 旧重采样，`--replay` 回放，`--noresample` 不重采样，`--timeframe` 目标周期，`--compression` 压缩比，`--indicators` 是否加指标，`--onlydaily` 仅日线指标，`--period` 指标周期，`--plot` 绘图 |
| **data-pandas** | 展示如何利用 Pandas DataFrame 加载本地或外部数据源，并将其无缝对接到 Backtrader 框架中。 | `--noheaders` 不使用表头，`--noprint` 不打印DataFrame |
| **data-replay** | 演示数据回放（Replay）功能，可将低周期数据回放为高周期数据，支持自定义数据文件、回放周期、压缩比、指标周期等。 | `--dataname` 数据文件，`--oldrp` 旧回放，`--timeframe` 目标周期，`--compression` 压缩比，`--period` 指标周期 |
| **data-resample** | 展示如何对原始行情数据进行重采样，支持自定义数据文件、目标周期、压缩比、是否使用旧重采样器等。 | `--dataname` 数据文件，`--oldrs` 旧重采样，`--timeframe` 目标周期，`--compression` 压缩比 |
| **bidask-to-ohlc** | 将原始 Tick 级别的买卖价数据转换为标准 OHLC（开高低收）格式，便于后续技术分析和策略开发。 | `--data` 数据文件路径，`--compression` 重采样间隔，`--plot` 绘图 |
| **ib-cash-bid-ask** | 演示如何通过 Interactive Brokers（IB）接口加载现金市场的买卖价数据，适合实盘或仿真交易环境。 | 无参数，直接运行 |
| **oandatest** | 展示如何对接 OANDA 外汇数据源，加载外汇行情数据并进行策略回测。 | 无参数，直接运行 |
| **yahoo-test** | 演示如何从 Yahoo Finance 自动下载历史行情数据，支持自定义股票代码、起止日期、SMA周期、是否写文件/绘图等。 | `--data` 股票代码，`--fromdate` 起始日期，`--todate` 结束日期，`--period` SMA周期，`--writer` 添加writer，`--wrcsv` writer输出csv，`--plot` 绘图，`--numfigs` 绘图窗口数 |

---

## **策略开发**

| 示例程序名称 | 详细功能描述 | 参数/使用方法 |
|--------------|----------|---------------|
| **sigsmacross** | 实现基于简单移动平均线（SMA）交叉的入场和出场信号，支持自定义数据、起止日期、初始资金、下单量、策略参数、绘图等。 | `--data` 股票代码，`--fromdate` 起始日期，`--todate` 结束日期，`--cash` 初始资金，`--stake` 下单量，`--strat` 策略参数，`--plot` 绘图 |
| **macd-settings** | 演示如何自定义 MACD 指标参数，并基于 MACD 金叉死叉进行交易决策。 | 详见脚本内部参数设置，无命令行参数 |
| **psar** | 实现基于抛物线转向指标（Parabolic SAR）的趋势跟踪策略，自动识别多空转折点。 | 详见脚本内部参数设置，无命令行参数 |
| **btfd** | “Buy the F***ing Dip” 策略实现，捕捉市场大幅下跌后的反弹机会。 | 详见脚本内部参数设置，无命令行参数 |
| **kselrsi** | 结合 RSI 指标和 Keltner 通道，构建动量与波动率结合的交易策略。 | 详见脚本内部参数设置，无命令行参数 |
| **lrsi** | 仅基于 RSI 指标的超买超卖信号进行交易，适合震荡行情。 | 详见脚本内部参数设置，无命令行参数 |
| **pivot-point** | 利用每日枢轴点（Pivot Point）计算支撑/阻力位，自动生成突破或反转信号。 | 详见脚本内部参数设置，无命令行参数 |
| **renko** | 基于 Renko 砖块图表的趋势策略，过滤市场噪音，专注于大级别行情波动。 | 详见脚本内部参数设置，无命令行参数 |
| **vwr** | 采用波动率加权回报（VWR）方法，动态调整持仓权重，支持多种回报参数、周期、年化因子、标准差修正、绘图等。 | `--data` 数据文件，`--cash` 初始资金，`--fromdate` 起始日期，`--todate` 结束日期，`--writercsv` 输出csv，`--tframe` 回报周期，`--sigma-max` 最大sigma，`--tau` tau因子，`--tann` 年化因子，`--stddev-sample` 标准差修正，`--plot` 绘图 |
| **multidata-strategy** | 演示如何在同一策略中同时处理多只标的，实现多品种协同交易。 | 详见脚本内部参数设置，无命令行参数 |
| **mixing-timeframes** | 展示如何在策略中混合使用不同时间周期的数据（如日线信号+分钟线执行），提升策略灵活性。 | 详见脚本内部参数设置，无命令行参数 |
| **multi-example** | 多资产、多周期、多信号的综合策略示例，适合复杂策略开发参考。 | 详见脚本内部参数设置，无命令行参数 |

---

## **交易执行与订单管理**

| 示例程序名称 | 详细功能描述 | 参数/使用方法 |
|--------------|----------|---------------|
| **bracket** | 演示如何使用括号订单（Bracket Order），即同时设置止盈、止损和主订单，实现自动风控。 | 详见脚本内部参数设置，无命令行参数 |
| **oco** | 展示 OCO（One Cancels Other）订单用法，两个订单互为条件，任一成交则取消另一个，适合突破策略。 | 详见脚本内部参数设置，无命令行参数 |
| **order-close** | 演示如何手动或自动平仓，适用于止盈、止损或策略信号反转时的仓位管理。 | 详见脚本内部参数设置，无命令行参数 |
| **order-execution** | 展示订单的执行过程，包括市价单、限价单等不同类型订单的提交与成交机制。 | 详见脚本内部参数设置，无命令行参数 |
| **order-history** | 演示如何查询和管理历史订单记录，便于回测结果分析和实盘订单追踪。 | 详见脚本内部参数设置，无命令行参数 |
| **order_target** | 展示如何使用目标持仓订单（order_target），自动调整持仓到指定数量或比例。 | 详见脚本内部参数设置，无命令行参数 |
| **slippage** | 演示滑点（Slippage）处理方法，模拟实际交易中因流动性导致的成交价偏差。 | 详见脚本内部参数设置，无命令行参数 |
| **commission-schemes** | 展示不同佣金方案（如固定费率、阶梯费率等）对策略回测结果的影响。 | 详见脚本内部参数设置，无命令行参数 |

---

## **回测与优化**

| 示例程序名称 | 详细功能描述 | 参数/使用方法 |
|--------------|----------|---------------|
| **optimization** | 演示如何对策略参数进行批量优化，自动寻找最优参数组合。 | 详见脚本内部参数设置，无命令行参数 |
| **sharpe-timereturn** | 基于夏普比率和时间回报等指标对策略进行多维度优化，提升风险调整后收益。 | 详见脚本内部参数设置，无命令行参数 |
| **sratio** | 采用 Sortino 比率作为优化目标，关注下行风险，适合稳健型策略开发。 | 详见脚本内部参数设置，无命令行参数 |
| **stop-trading** | 演示如何在特定条件下自动停止交易，适合风控或策略暂停场景。 | 详见脚本内部参数设置，无命令行参数 |
| **stoptrail** | 展示跟踪止损（Trailing Stop）机制，动态保护盈利，减少回撤。 | 详见脚本内部参数设置，无命令行参数 |
| **observer-benchmark** | 演示如何添加观察者（Observer）和基准（Benchmark），用于回测结果的对比分析。 | 详见脚本内部参数设置，无命令行参数 |
| **observers** | 展示多种内置观察者的用法，如资金曲线、持仓、成交等，便于回测过程监控。 | 详见脚本内部参数设置，无命令行参数 |

---

## **结果分析与可视化**

| 示例程序名称 | 详细功能描述 | 参数/使用方法 |
|--------------|----------|---------------|
| **analyzer-annualreturn** | 计算并分析策略的年化回报率，支持指定数据区间、SMA周期、仅做多等选项，并可绘制回报曲线。 | `--data` 数据文件路径，`--fromdate` 起始日期，`--todate` 结束日期，`--period` SMA周期，`--onlylong` 仅做多，`--writercsv` 输出csv，`--csvcross` 输出交叉信号csv，`--tframe` 回报周期，`--legacyannual` 兼容旧年化分析，`--cash` 初始资金，`--comm` 佣金，`--mult` 乘数，`--margin` 保证金，`--stake` 下单量，`--plot` 绘图，`--numfigs` 绘图窗口数 |
| **calmar** | 计算 Calmar 比率（年化收益/最大回撤），衡量策略风险收益比。 | 详见脚本内部参数设置，无命令行参数 |
| **pyfoliotest** | 演示如何集成 Pyfolio 工具包，对策略绩效进行专业分析（如收益分布、风险指标等）。 | 详见脚本内部参数设置，无命令行参数 |
| **pyfolio2** | Pyfolio 分析的另一种实现方式，展示不同集成方法。 | 详见脚本内部参数设置，无命令行参数 |
| **plot-same-axis** | 演示如何在同一坐标轴上绘制多组数据，便于对比分析。 | 详见脚本内部参数设置，无命令行参数 |
| **partial-plot** | 展示如何只绘制部分时间区间的数据，适合大数据量或重点区间分析。 | 详见脚本内部参数设置，无命令行参数 |
| **lineplotter** | 演示自定义线图绘制方法，支持多种数据类型和样式。 | 详见脚本内部参数设置，无命令行参数 |

---

## **其他功能**

| 示例程序名称 | 详细功能描述 | 参数/使用方法 |
|--------------|----------|---------------|
| **calendar-days** | 演示如何处理日历日（包括节假日、非交易日等），保证回测数据的完整性。 | 详见脚本内部参数设置，无命令行参数 |
| **tradingcalendar** | 展示自定义或第三方交易日历的集成方法，适合不同市场的交易日管理。 | 详见脚本内部参数设置，无命令行参数 |
| **weekdays-filler** | 对工作日数据进行自动填充，适合用于缺失数据的修复和对齐。 | `--online` 是否在线获取数据，`--data0` 主数据，`--data1` 副数据，`--sma` 是否加均线，`--fillclose` 用收盘价填充，`--filler` 是否填充，`--filler0` 仅填充主数据，`--filler1` 仅填充副数据，`--fromdate` 起始日期，`--todate` 结束日期，`--plot` 绘图 |
| **cheat-on-open** | 演示“开盘作弊”功能，即在开盘价已知的情况下提前下单，适合信号延迟测试。 | 详见脚本内部参数设置，无命令行参数 |
| **credit-interest** | 展示如何模拟信用利息（如融资融券利息）对资金曲线的影响。 | 详见脚本内部参数设置，无命令行参数 |
| **memory-savings** | 演示内存优化技巧，适合大数据量回测或资源受限环境。 | 详见脚本内部参数设置，无命令行参数 |
| **rollover** | 演示期货合约的自动滚动（Rollover）处理，适合多合约连续回测。 | 详见脚本内部参数设置，无命令行参数 |
| **timers** | 展示定时器（Timer）功能，可定时触发策略事件或信号。 | 详见脚本内部参数设置，无命令行参数 |

---

## **测试与验证**

| 示例程序名称 | 详细功能描述 | 参数/使用方法 |
|--------------|----------|---------------|
| **vctest** | 用于功能验证的测试脚本，覆盖框架核心功能，适合回归测试。支持多数据、时间同步、回放/重采样、下单类型、账户等多种参数。 | `--exactbars` 精确bars，`--plot` 绘图，`--stopafter` 停止行数，`--nostore` 不用store，`--qcheck` 检查间隔，`--no-timeoffset` 不用时间偏移，`--data0` 主数据，`--tradename` 交易名，`--data1` 副数据，`--timezone` 时区，`--historical` 仅历史，`--fromdate` 起始日期，`--todate` 结束日期，`--smaperiod` 均线周期，`--replay` 回放，`--resample` 重采样，`--timeframe` 时间周期，`--compression` 压缩比，`--no-bar2edge` 不对齐，`--no-adjbartime` 不调整bar时间，`--no-rightedge` 不右对齐，`--broker` 使用VC券商，`--account` 账户，`--trade` 买卖操作，`--donotsell` 不卖出，`--exectype` 下单类型，`--price` 限价，`--pstoplimit` 止损限价，`--stake` 下单量，`--valid` 有效期，`--cancel` 撤单周期 |
| **sizertest** | 演示订单大小（Sizer）模块的用法，测试不同下单量算法的效果。 | 详见脚本内部参数设置，无命令行参数 |
| **strategy-selection** | 展示如何在回测中动态选择和切换不同策略，适合多策略组合研究。 | 详见脚本内部参数设置，无命令行参数 |
| **volumefilling** | 测试成交量数据的填充和处理，适合成交量驱动型策略。 | `--data` 数据文件，`--cash` 初始资金，`--filler` 填充方法，`--filler-args` 填充参数，`--stakeperc` 持仓百分比，`--opbreak` 操作间隔，`--fromdate` 起始日期，`--todate` 结束日期，`--plot` 绘图 |
| **relative-volume** | 演示相对成交量指标的计算和应用，辅助判断市场活跃度。 | 详见脚本内部参数设置，无命令行参数 |
